<article ng-controller="Graph">
    <div class="panel-group"
         id="accordionGraph">
        <div class="panel panel-default">
            <div class="panel-heading"
                 role="tab">
                <h4 class="panel-title"
                    ng-class="{ dropup: graph.open }"
                    role="button"
                    data-toggle="collapse"
                    data-parent="#accordionGraph"
                    href="#graphContainer"
                    ng-click="graph.draw(); graph.open = !graph.open"><span class="caret"></span> Répartition de la charge de travail</h4>
            </div>
        </div>

        <figure class="panel-collapse collapse"
                id="graphContainer">
            <div id="graph"></div>
            <div ng-if="graph.noData">
                <h4 class="text-center">Aucune donnée</h4>
            </div>

        </figure>
    </div>
</article>

<hr/>

<!--<pre>{{fichesRecherche.datasSearch|json}}</pre>-->

<div class="panel-group"
     id="accordion"
     ng-show="routeParams.onglet!=='affaire'">
    <div class="panel panel-default">
        <div class="panel-heading"
             role="tab"
             id="headingOne">
            <h4 class="panel-title"
                role="button"
                data-toggle="collapse"
                data-parent="#accordion"
                href="#formRecherche"
                ng-class="{ dropup: fichesRecherche.open }"
                ng-click="fichesRecherche.open = !fichesRecherche.open">
                <span class="caret"></span> Recherche avancée
            </h4>
        </div>
    </div>
    <div class="panel-collapse collapse"
         id="formRecherche">

        <form class="row panel-body">

            <div class="col-md-4">
                <div class="form-group">
                    <label>Demandeur :</label>
                    <angucomplete-alt
                            id="agentAutocompleteInput0"
                            input-class="form-control"
                            selected-object="fichesRecherche.datasSearch.cpdemandeur"
                            initial-value="{{fichesRecherche.datasSearch.cpdemandeur.title}}"
                            remote-url="{{DIURLAPI.URLapiRemote + 'agent/recherche/all/'}}"
                            remote-url-data-field="L_Resultats"
                            title-field="display"
                            description-field="cp"
                            search-fields="display, cp"
                            pause="400"
                            match-class="bold"
                            minlength="3"
                            text-no-results="Aucun résultat"
                            text-searching="Recherche en cours..."
                            template-url="views/ficheAgadir/DemandeurAutocomplete.html"></angucomplete-alt>
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label>Materiel :</label>
                    <angucomplete-alt
                            id="posteAutocompleteInput0"
                            input-class="form-control"
                            selected-object="fichesRecherche.datasSearch.materiel"
                            initial-value="{{fichesRecherche.datasSearch.materiel.title}}"
                            remote-url="{{DIURLAPI.URLGemini + 'materiel/'}}"
                            remote-url-data-field="L_Resultats"
                            search-fields="calife"
                            title-field="calife"
                            description-field="description"
                            pause="400"
                            match-class="bold"
                            minlength="1"
                            text-no-results="Aucun résultat"
                            text-searching="Recherche en cours..."
                            template-url="views/ficheAgadir/PosteAutocomplete.html"></angucomplete-alt>
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label>Projet :</label>
                    <span class="input-group">
                        <angucomplete-alt
                            id="projectAutocompleteInput0"
                            input-class="form-control angucomplete-decale"
                            selected-object="fichesRecherche.datasSearch.projet"
                            initial-value="{{fichesRecherche.datasSearch.projet.description.intitule}}"
                            title-field="intitule"
                            search-fields="intitule"
                            local-data="DatasProjets.liste"
                            pause="0"
                            match-class="bold"
                            minlength="1"
                            text-no-results="Aucun résultat"
                            text-searching="Recherche en cours..."
                            template-url="views/ficheAgadir/ProjetAutocomplete.html"></angucomplete-alt>
                        <span class="input-group-btn"
                              title="Liste des projets">
                            <button class="btn btn-default"
                                    data-toggle="modal"
                                    data-target="#ProjetsModal">
                                <span class="glyphicon glyphicon-list"></span>
                            </button>
                        </span>
                    </span>
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label>État :</label>
                    <select class="form-control"
                            ng-model="fichesRecherche.datasSearch.etat"
                            ng-options="label for label in EtatsList.liste"></select>
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label>Agent :</label>
                    <select class="form-control"
                            ng-model="fichesRecherche.datasSearch.cpagent"
                            ng-options="agent.cp as agent.nomPrenom for agent in Fiches.Agents"></select>
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label>Clôturé :</label>
                    <select class="form-control"
                            ng-model="fichesRecherche.datasSearch.isCloture">
                        <option value="undefined"></option>
                        <option value="true">Oui</option>
                        <option value="false">Non</option>
                    </select>
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label>Description :</label>
                    <input class="form-control" type="text" ng-model="fichesRecherche.datasSearch.description">
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label>Date de début :</label>
                    <div class="input-form date">
                        <input type="text"
                               id="datetimepicker1"
                               class="form-control"
                               placeholder="JJ/MM/AAAA"
                               ng-model="fichesRecherche.datasSearch.dateDebut"
                               pick-a-date="date"
                               pick-a-date-options="{ format: 'dd/mm/yyyy', onSet: blurInput }"/>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label>Date de fin :</label>
                    <div class="input-form date">
                        <input type="text"
                               id="datetimepicker2"
                               class="form-control"
                               placeholder="JJ/MM/AAAA"
                               ng-model="fichesRecherche.datasSearch.dateFin"
                               pick-a-date="date"
                               pick-a-date-options="{ format: 'dd/mm/yyyy', onSet: blurInput }"/>
                    </div>
                </div>
            </div>

            <div class="col-md-4 col-md-offset-4 text-center">
                <button class="btn btn-blue"
                        ng-click="fichesRecherche.Search()">Rechercher
                </button>
                <button class="btn btn-blue"
                        ng-click="fichesRecherche.Reset()">Réinitialiser
                </button>
            </div>

            <div class="col-md-12">&nbsp;</div>
        </form>
    </div>
</div>

<nav ng-controller="Onglets">
    <ul class="nav nav-tabs">
        <li ng-class="{ active : (onglets.routeParams.onglet === 'mesfiches' || onglets.routeParams.onglet === undefined)}">
            <a ng-href="#/gestionFiches/mesfiches">Mes fiches ({{onglets.NbFiches.Nb}})</a>
        </li>
        <li ng-class="{ active : (onglets.routeParams.onglet === 'dispatch')}">
            <a ng-href="#/gestionFiches/dispatch">À dispatcher ({{onglets.NbFichesDispatch.Nb}})</a>
        </li>
        <li ng-class="{ active : (onglets.routeParams.onglet === 'BO')}">
            <a ng-href="#/gestionFiches/BO">Back office ({{onglets.NbFichesBO.Nb}})</a>
        </li>
        <li ng-class="{ active : (onglets.routeParams.onglet === 'attente')}">
            <a ng-href="#/gestionFiches/attente">En attente ({{onglets.NbFichesAttente.Nb}})</a>
        </li>
        <li ng-class="{ active : (onglets.routeParams.onglet === 'prioritaires')}">
            <a ng-href="#/gestionFiches/prioritaires">Prioritaires ({{onglets.NbFichesPrioritaires.Nb}})</a>
        </li>
        <li ng-class="{ active : (onglets.routeParams.onglet === 'toutes')}">
        <a ng-href="#/gestionFiches/toutes">Toutes ({{onglets.NbFichesToutes.Nb}})</a>
        </li>
        <li ng-class="{ active : (onglets.routeParams.onglet === 'affaire')}">
            <a ng-href="#/gestionFiches/affaire">Affaires ({{onglets.NbFichesAffaire.Nb}})</a>
        </li>
        <li ng-class="{ active : (onglets.routeParams.onglet === 'cartographie')}">
            <a ng-href="#/gestionFiches/cartographie">Cartographie</a>
        </li>
        <li ng-if="fichesRecherche.show"
            ng-class="{ active : (onglets.routeParams.onglet === 'recherche')}">
            <a ng-href="{{fichesRecherche.urlGet}}">
                Recherche ({{onglets.NbFichesRecherche.Nb}})
            </a>
        </li>
        <li ng-if="fichesRecherche.show">
            <button type="button"
                    class="close"
                    ng-click="fichesRecherche.reset()">
                <span>&times;</span>
            </button>
        </li>
    </ul>

    <div class="tab-content">
        <div ng-if="onglets.routeParams.onglet === 'mesfiches' || onglets.routeParams.onglet === undefined">
            <div ng-controller="mesfiches">
                <div style="position: relative">
                    <div ng-include="'views/listeInter.html'"></div>
                    <div class="loading"
                         ng-class="{ flex: mesfiches.isLoading }"
                         ng-hide="!mesfiches.isLoading">
                        <div></div>
                    </div>
                </div>

                <div>
                    <ul class="nav nav-tabs">
                        <li  ng-if="Fiches.mesfichesAttente.Liste.length > 0" class="active">
                            <a href data-target="#attentes" role="tab" data-toggle="tab" > Mes fiches en attentes ({{Fiches.mesfichesAttente.Liste.length}})</a>
                        </li>
                        <li ng-if="affaires.liste.length > 0" ng-class="{active : affaires.liste.length > 0 && Fiches.mesfichesAttente.Liste.length === 0}">
                            <a href data-target="#affaires" role="tab" data-toggle="tab" > Mes affaires ({{affaires.liste.length}})</a>
                        </li>
                    </ul>
                    <div class="tab-content"
                         style="position: relative">
                        <div ng-if="Fiches.mesfichesAttente.Liste.length > 0" role="tabpanel" class="tab-pane active" id="attentes">
                            <div style="position: relative">
                                <div ng-controller="mesfichesAttente" ng-include="'views/listeInter.html'"></div>
                                <div class="loading"
                                     ng-class="{ flex: affaires.isLoading }"
                                     ng-hide="!affaires.isLoading">
                                    <div></div>
                                </div>
                            </div>
                        </div>

                        <div ng-if="affaires.liste.length > 0" ng-class="{active : affaires.liste.length > 0 && Fiches.mesfichesAttente.Liste.length === 0}"  role="tabpanel" class="tab-pane" id="affaires">
                            <div style="position: relative">
                                <div ng-include="'views/affaire/affairesListe.html'"></div>
                                <div class="loading"
                                     ng-class="{ flex: affaires.isLoading }"
                                     ng-hide="!affaires.isLoading">
                                    <div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!--<div ng-if="affaires.liste.length > 0">
                    <ul class="nav nav-tabs">
                        <li class="active">
                            <a>Mes affaires ({{affaires.liste.length}})</a>
                        </li>
                    </ul>
                    <div class="tab-content"
                         style="position: relative">
                        <div ng-include="'views/affaire/affairesListe.html'"></div>
                        <div class="loading"
                             ng-class="{ flex: affaires.isLoading }"
                             ng-hide="!affaires.isLoading">
                            <div></div>
                        </div>
                    </div>
                </div>-->
            </div>
        </div>

        <div ng-if="onglets.routeParams.onglet === 'dispatch'">
            <div style="position: relative"
                 ng-controller="dispatch">
                <div ng-include="'views/listeInter.html'"></div>
                <div class="loading"
                     ng-class="{ flex: fichesDispatch.isLoading }"
                     ng-hide="!fichesDispatch.isLoading">
                    <div></div>
                </div>
            </div>
        </div>

        <div ng-if="onglets.routeParams.onglet === 'BO'">
            <div style="position: relative"
                 ng-controller="BO">
                <div ng-include="'views/listeInter.html'"></div>
                <div class="loading"
                     ng-class="{ flex: fichesBO.isLoading }"
                     ng-hide="!fichesBO.isLoading">
                    <div></div>
                </div>
            </div>
        </div>

        <div ng-if="onglets.routeParams.onglet === 'attente'" >
            <div style="position: relative"
                 ng-controller="attente">
                <div ng-include="'views/listeInter.html'"></div>
                <div class="loading"
                     ng-class="{ flex: fichesAttente.isLoading }"
                     ng-hide="!fichesAttente.isLoading">
                    <div></div>
                </div>
            </div>
        </div>

        <div ng-if="onglets.routeParams.onglet === 'prioritaires'" >
            <div style="position: relative"
                 ng-controller="prioritaires">
                <div ng-include="'views/listeInter.html'"></div>
                <div class="loading"
                     ng-class="{ flex: fichesPrioritaires.isLoading }"
                     ng-hide="!fichesPrioritaires.isLoading">
                    <div></div>
                </div>
            </div>
        </div>

        <div ng-if="onglets.routeParams.onglet === 'toutes'">
            <div style="position: relative"
                 ng-controller="toutes">
                <div ng-include="'views/listeInter.html'"></div>
                <div class="loading"
                     ng-class="{ flex: fichesToutes.isLoading }"
                     ng-hide="!fichesToutes.isLoading">
                    <div></div>
                </div>
            </div>
        </div>

        <div ng-show="onglets.routeParams.onglet === 'affaire'">
            <div style="position:relative"
                 ng-controller="Affaires">
                <div ng-include="'views/affaire/affairesListe.html'"></div>
                <div class="loading"
                     ng-class="{ flex: affaires.isLoading }"
                     ng-hide="!affaires.isLoading">
                    <div></div>
                </div>
            </div>
        </div>
        
        <div ng-if="onglets.routeParams.onglet === 'cartographie'">
            <div style="position: relative;">
                <!--PROD-->
                <div ng-include="'http://x18srhrgcb7:8044/static/html'"></div>
                <!--LOCAL
                <div ng-include="'views/carto/cartographie.html'"></div>-->
            </div>
        </div>

        <div ng-if="onglets.routeParams.onglet === 'recherche'">
            <div style="position: relative"
                 ng-controller="recherche">
                <div ng-include="'views/listeInter.html'"></div>
                <div class="loading"
                     ng-class="{ flex: fichesRecherche.isLoading }"
                     ng-hide="!fichesRecherche.isLoading">
                    <div></div>
                </div>
            </div>
        </div>

    </div>
</nav>